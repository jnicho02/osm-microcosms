<% content_for :heading do %>
  <h1><%= "Microcosm" %></h1>
<% end %>

<h1>
  <%= link_to @microcosm.name, @microcosm %>
</h1>
<p>
  Location: <%= @microcosm.location %>
</p>
<p>
  Coordinates: <%= @microcosm.lat %>, <%= @microcosm.lon %>
</p>
<p>
  <%= auto_link @microcosm.description %>
</p>
<label>Share</label>
<ul>
  <% @microcosm.microcosm_links.each do |link| %>
    <li>
      <a href="<%= link.url %>"><%= link.site %></a>
    </li>
  <% end %>
</ul>

<label>Organizers</label>
<ul>
  <% @microcosm.microcosm_members.each do |membership| %>
    <li>
      <%= link_to membership.user.display_name, user_path(membership.user) %>
    </li>
  <% end %>
</ul>

<% if current_user %>
  <%= form_with scope: :microcosm_member, url: microcosm_member_index_path do |form| %>
    <%= form.hidden_field(:microcosm_id, :value => @microcosm.id) %>
    <%= form.hidden_field(:user_id, :value => current_user.id) %>
    <%= form.submit :value => t('microcosm.join.action') %>
  <% end %>
<% else %>
  Log in to join this microcosm.
<% end %>

<h2>Events</h2>
<p>
  <% if current_user && @microcosm.has_organizer?(current_user) %>
    <%= link_to 'new event', new_event_path(microcosm_id: @microcosm.id) %>
  <% end %>
</p>
<ul>
  <% @microcosm.events.each do |event| %>
    <li>
      <%= link_to event.title + ' ' + event.moment.to_s, event_path(event) %>
      </li>
  <% end %>
</ul>

<h2>Members</h2>
<% @microcosm.microcosm_members.each do |membership| %>
  <%= link_to membership.user.display_name, user_path(membership.user) %> (<%= link_to "promote", edit_microcosm_member_path(membership) %>)
<% end %>
